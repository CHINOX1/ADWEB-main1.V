

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WEB.forms &mdash; MiProyecto  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MiProyecto
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Módulos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MiProyecto</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">WEB.forms</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for WEB.forms</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Módulo de formularios para el sistema de gestión empresarial.</span>

<span class="sd">Contiene formularios para:</span>
<span class="sd">- Registro y edición de empresas</span>
<span class="sd">- Gestión de usuarios (admin, supervisores, trabajadores)</span>
<span class="sd">- Control de permisos</span>
<span class="sd">- Registro de entradas/salidas</span>
<span class="sd">- Configuración de planes y límites</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreationForm</span><span class="p">,</span> <span class="n">UserChangeForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Usuario</span><span class="p">,</span> <span class="n">RegistroEmpresas</span><span class="p">,</span> <span class="n">RegistroPermisos</span><span class="p">,</span> <span class="n">RegistroEntrada</span><span class="p">,</span> <span class="n">VigenciaPlan</span><span class="p">,</span> <span class="n">Plan</span><span class="p">,</span> <span class="n">Provincia</span><span class="p">,</span> <span class="n">Comuna</span><span class="p">,</span> <span class="n">Region</span>

<div class="viewcode-block" id="EmpresaForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.EmpresaForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EmpresaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario completo para el registro y modificación de empresas.</span>
<span class="sd">    </span>
<span class="sd">    Hereda de ModelForm y utiliza el modelo RegistroEmpresas.</span>
<span class="sd">    Implementa lógica dinámica para selección de ubicación geográfica.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        Meta.model (RegistroEmpresas): Modelo asociado al formulario</span>
<span class="sd">        Meta.fields (list): Lista de todos los campos del modelo</span>
<span class="sd">        Meta.widgets (dict): Configuración personalizada de widgets para cada campo</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Inicializa los querysets dinámicos para provincias y comunas</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="EmpresaForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.EmpresaForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;rut&#39;</span><span class="p">,</span> <span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;giro&#39;</span><span class="p">,</span> <span class="s1">&#39;direccion&#39;</span><span class="p">,</span> <span class="s1">&#39;numero&#39;</span><span class="p">,</span> <span class="s1">&#39;oficina&#39;</span><span class="p">,</span>
            <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;provincia&#39;</span><span class="p">,</span> <span class="s1">&#39;comuna&#39;</span><span class="p">,</span> <span class="s1">&#39;telefono&#39;</span><span class="p">,</span> <span class="s1">&#39;celular&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;vigente&#39;</span><span class="p">,</span> <span class="s1">&#39;estado&#39;</span><span class="p">,</span> <span class="s1">&#39;rut_representante&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nombre_representante&#39;</span><span class="p">,</span> <span class="s1">&#39;nombre_contacto&#39;</span><span class="p">,</span> <span class="s1">&#39;celular_contacto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mail_contacto&#39;</span><span class="p">,</span> <span class="s1">&#39;plan_contratado&#39;</span>
        <span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;rut&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;giro&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;direccion&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;numero&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;oficina&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;provincia&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;comuna&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;telefono&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;celular&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">URLInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;vigente&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">CheckboxInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-check-input&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;estado&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;rut_representante&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;nombre_representante&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;nombre_contacto&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;celular_contacto&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;mail_contacto&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;plan_contratado&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="EmpresaForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.EmpresaForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa el formulario con querysets dinámicos para provincias y comunas.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            *args: Argumentos posicionales</span>
<span class="sd">            **kwargs: Argumentos clave (incluye &#39;instance&#39; para edición)</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Actualiza provincias basado en la región seleccionada</span>
<span class="sd">            - Actualiza comunas basado en la provincia seleccionada</span>
<span class="sd">            - Maneja tanto creación como edición de instancias</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;provincia&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Provincia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Comuna</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

        <span class="c1"># Lógica para actualización dinámica de provincias</span>
        <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">region_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;provincia&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Provincia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">region_id</span><span class="o">=</span><span class="n">region_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># Mantener queryset vacío si hay error en los datos</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;provincia&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">provincia_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># Lógica para actualización dinámica de comunas</span>
        <span class="k">if</span> <span class="s1">&#39;provincia&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">provincia_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;provincia&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Comuna</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">provincia_id</span><span class="o">=</span><span class="n">provincia_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">provincia</span><span class="o">.</span><span class="n">comuna_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="PermisoForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PermisoForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PermisoForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para la creación y edición de permisos de usuario.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        Meta.model (RegistroPermisos): Modelo asociado al formulario</span>
<span class="sd">        Meta.fields (list): Campos a incluir [&#39;nombre&#39;, &#39;descripcion&#39;]</span>
<span class="sd">        Meta.widgets (dict): Configuración de widgets para cada campo</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PermisoForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PermisoForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RegistroPermisos</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;descripcion&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span> <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
        <span class="p">}</span></div>
</div>


<div class="viewcode-block" id="AdminForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.AdminForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario especializado para creación de administradores.</span>
<span class="sd">    </span>
<span class="sd">    Hereda de UserCreationForm y añade:</span>
<span class="sd">        - Asignación automática de rol &#39;admin&#39;</span>
<span class="sd">        - Otorgamiento de todos los permisos existentes</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        Meta.model (Usuario): Modelo de usuario</span>
<span class="sd">        Meta.fields (list): Campos del formulario</span>
<span class="sd">        Meta.widgets (dict): Configuración de widgets para campos de contraseña</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        save: Guarda el usuario con rol y permisos adecuados</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AdminForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.AdminForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;password1&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;password2&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="AdminForm.save">
<a class="viewcode-back" href="../../modules.html#WEB.forms.AdminForm.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Guarda el usuario administrador con todos los permisos.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            commit (bool): Determina si guardar en la base de datos</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Usuario: Instancia del usuario administrador creado</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Establece el rol como &#39;admin&#39;</span>
<span class="sd">            - Asigna todos los permisos existentes</span>
<span class="sd">            - Guarda relaciones many-to-many</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">user</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span></div>
</div>


<div class="viewcode-block" id="SupervisorForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SupervisorForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para creación de supervisores con permisos limitados.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        empresa (ModelChoiceField): Selector de empresa asociada</span>
<span class="sd">        permisos (ModelMultipleChoiceField): Selector múltiple de permisos</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Personaliza los querysets según el usuario creador</span>
<span class="sd">        save: Asigna el rol &#39;supervisor&#39; al guardar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empresa</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">})</span>
    <span class="p">)</span>
    <span class="n">permisos</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<div class="viewcode-block" id="SupervisorForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span> <span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;permisos&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="SupervisorForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa el formulario con restricciones de permisos y empresas.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user (Usuario): Usuario que crea el supervisor (obtenido de kwargs)</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Para no-admins: Restringe a su empresa y permisos asignados</span>
<span class="sd">            - Para admins: Permite todas las empresas y permisos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;empresa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">empresa</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>


<div class="viewcode-block" id="SupervisorForm.save">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorForm.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Guarda el usuario con rol de supervisor y permisos asignados.&quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;supervisor&#39;</span>
        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span></div>
</div>


<div class="viewcode-block" id="TrabajadorForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TrabajadorForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para creación de trabajadores con restricciones de empresa.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        empresa (ModelChoiceField): Selector de empresa asociada</span>
<span class="sd">        permisos (ModelMultipleChoiceField): Selector múltiple de permisos</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Personaliza querysets según el usuario creador</span>
<span class="sd">        save: Asigna el rol &#39;trabajador&#39; al guardar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empresa</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">})</span>
    <span class="p">)</span>
    <span class="n">permisos</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<div class="viewcode-block" id="TrabajadorForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span> <span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;permisos&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="TrabajadorForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configura los querysets de empresa y permisos.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user (Usuario): Usuario que crea el trabajador</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Para no-admins: Restringe a su empresa y permisos</span>
<span class="sd">            - Para admins: Permite todas las empresas y permisos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;empresa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">empresa</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>


<div class="viewcode-block" id="TrabajadorForm.save">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorForm.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Guarda el usuario con rol de trabajador y permisos asignados.&quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;trabajador&#39;</span>
        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span></div>
</div>


<div class="viewcode-block" id="AdminEditForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.AdminEditForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminEditForm</span><span class="p">(</span><span class="n">UserChangeForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para edición de administradores con gestión de permisos.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        empresa (ModelChoiceField): Selector de empresa asociada</span>
<span class="sd">        permisos (ModelMultipleChoiceField): Selector de permisos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empresa</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">})</span>
    <span class="p">)</span>
    <span class="n">permisos</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<div class="viewcode-block" id="AdminEditForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.AdminEditForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;permisos&#39;</span><span class="p">]</span></div>
</div>


<div class="viewcode-block" id="SupervisorEditForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorEditForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SupervisorEditForm</span><span class="p">(</span><span class="n">UserChangeForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para edición de supervisores con restricciones de permisos.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        empresa (ModelChoiceField): Selector de empresa asociada</span>
<span class="sd">        permisos (ModelMultipleChoiceField): Selector de permisos</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Configura los permisos disponibles según el editor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empresa</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">})</span>
    <span class="p">)</span>
    <span class="n">permisos</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<div class="viewcode-block" id="SupervisorEditForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorEditForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;permisos&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="SupervisorEditForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.SupervisorEditForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa el formulario con restricciones de permisos.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user (Usuario): Usuario que realiza la edición</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Establece permisos iniciales del usuario</span>
<span class="sd">            - Restringe permisos disponibles según el rol del editor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;empresa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">empresa</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="TrabajadorEditForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorEditForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TrabajadorEditForm</span><span class="p">(</span><span class="n">UserChangeForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para edición de trabajadores con gestión de permisos.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        empresa (ModelChoiceField): Selector de empresa asociada</span>
<span class="sd">        permisos (ModelMultipleChoiceField): Selector de permisos</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Configura los permisos disponibles según el editor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empresa</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">})</span>
    <span class="p">)</span>
    <span class="n">permisos</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<div class="viewcode-block" id="TrabajadorEditForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorEditForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Usuario</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;permisos&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="TrabajadorEditForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.TrabajadorEditForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa el formulario con restricciones de permisos.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user (Usuario): Usuario que realiza la edición</span>
<span class="sd">        </span>
<span class="sd">        Behavior:</span>
<span class="sd">            - Establece permisos iniciales del usuario</span>
<span class="sd">            - Restringe permisos disponibles según el rol del editor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;empresa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">empresa</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;permisos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">RegistroPermisos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="RegistroEntradaForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.RegistroEntradaForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RegistroEntradaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario base para registro de entradas (actualmente vacío).</span>
<span class="sd">    </span>
<span class="sd">    Nota: Campos definidos en la vista mediante lógica de negocio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RegistroEntradaForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.RegistroEntradaForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RegistroEntrada</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span></div>
</div>


<div class="viewcode-block" id="RegistroSalidaForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.RegistroSalidaForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RegistroSalidaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario base para registro de salidas (actualmente vacío).</span>
<span class="sd">    </span>
<span class="sd">    Nota: Campos definidos en la vista mediante lógica de negocio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RegistroSalidaForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.RegistroSalidaForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RegistroEntrada</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span></div>
</div>


<div class="viewcode-block" id="LimiteEmpresaForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.LimiteEmpresaForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LimiteEmpresaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario para establecer límites de usuarios por empresa.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        Meta.model (RegistroEmpresas): Modelo asociado</span>
<span class="sd">        Meta.fields (list): Campos de límites</span>
<span class="sd">        Meta.widgets (dict): Configuración de widgets numéricos</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="LimiteEmpresaForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.LimiteEmpresaForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RegistroEmpresas</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;limite_supervisores&#39;</span><span class="p">,</span> <span class="s1">&#39;limite_trabajadores&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;limite_supervisores&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
            <span class="p">}),</span>
            <span class="s1">&#39;limite_trabajadores&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
            <span class="p">}),</span>
        <span class="p">}</span></div>
</div>


<div class="viewcode-block" id="PlanVigenciaForm">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PlanVigenciaForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PlanVigenciaForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulario avanzado para gestión de vigencias de planes.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        precio_original (IntegerField): Campo adicional para precio base</span>
<span class="sd">        indefinido (BooleanField): Indicador de plan sin fecha fin</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __init__: Hace opcional el campo fecha_fin</span>
<span class="sd">        clean: Valida consistencia entre campos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">precio_original</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">}),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Precio base del plan sin descuentos&quot;</span>
    <span class="p">)</span>
    <span class="n">indefinido</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-check-input&#39;</span><span class="p">}),</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Plan Indefinido&#39;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Marcar si el plan no tiene fecha de expiración&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="PlanVigenciaForm.Meta">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PlanVigenciaForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">VigenciaPlan</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;empresa&#39;</span><span class="p">,</span> <span class="s1">&#39;plan&#39;</span><span class="p">,</span> <span class="s1">&#39;fecha_inicio&#39;</span><span class="p">,</span> <span class="s1">&#39;fecha_fin&#39;</span><span class="p">,</span> <span class="s1">&#39;indefinido&#39;</span><span class="p">,</span> <span class="s1">&#39;descuento&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;empresa&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-select&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;plan&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-select&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;fecha_inicio&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">DateInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;YYYY-MM-DD&#39;</span>
            <span class="p">}),</span>
            <span class="s1">&#39;fecha_fin&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">DateInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;YYYY-MM-DD&#39;</span>
            <span class="p">}),</span>
            <span class="s1">&#39;descuento&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">NumberInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span>
                <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;0-100%&#39;</span>
            <span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="PlanVigenciaForm.__init__">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PlanVigenciaForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hace opcional el campo fecha_fin durante la inicialización.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;fecha_fin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PlanVigenciaForm.clean">
<a class="viewcode-back" href="../../modules.html#WEB.forms.PlanVigenciaForm.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Valida la coherencia entre los campos del formulario.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: Si hay inconsistencia entre campos</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Datos limpios y validados</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">indefinido</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;indefinido&#39;</span><span class="p">)</span>
        <span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha_fin&#39;</span><span class="p">)</span>
        <span class="n">descuento</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;descuento&#39;</span><span class="p">)</span>

        <span class="c1"># Validación de plan indefinido</span>
        <span class="k">if</span> <span class="n">indefinido</span> <span class="ow">and</span> <span class="n">fecha_fin</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Un plan indefinido no puede tener fecha de finalización&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validación de rango de descuento</span>
        <span class="k">if</span> <span class="n">descuento</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">descuento</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;El descuento debe ser un porcentaje entre 0 y 100&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">cleaned_data</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Tu Nombre.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>